var Toolbar=function(){var a={version:"1.0.1",foldingPaths:{},foldingClass:null,isUnfolded:null},n=gina.Storage,o=new n({bucket:"gina"}),l=o.Collection("plugin"),t=null,e=null,i=!1,s=null,r=null,g=null,c=null,d=null,u="",f=null,b=null,p=null,v="",h=null,y=0,m=null,w=0,C=0,k="",x={},T=null,j=null,A=null,F=null,S=null,D=null,_=null,U=null,O=!0,J=null,N=null,E=null,I=function(){t=$("#gina-toolbar"),s=t.find(".gina-toolbar-tab > a"),r=$("#gina-toolbar-toggle"),g=$("#gina-toolbar-panels"),c=g.find(".gina-toolbar-panel"),f=$("#gina-toolbar-vposition"),b=$("#gina-toolbar-hposition"),p=f.add(b),h=$("#gina-toolbar-width"),m=t.find(".gina-toolbar-main"),j=$("#gina-toolbar-json"),A=$("#gina-toolbar-gina-json"),F=$("#gina-toolbar-toggle-code-raw"),_=$("#gina-toolbar-data-html"),U=$("#gina-toolbar-code-toggle"),t.prepend('<textarea class="gina-toolbar-copy"></textarea>'),N=t.find(".gina-toolbar-copy"),e=l.findOne({_name:"toolbar"}),e||(e={_name:"toolbar",_version:a.version,_description:"Toolbar settings",_licence:"MIT",_author:[{name:"Fabrice Delaneau",company:"Freelancer"},{name:"Martin-Luther Etouman",company:"Rhinostone"}],position:"top-right",width:"30",panelId:"#gina-toolbar-data",isCollapsed:!0,isUnfolded:{}},l.insert(e)),e._version!=a.version&&P(),v=e.position,y=e.width,u=e.panelId,i=e.isCollapsed,R()},P=function(){e._version<"1.0.1"&&(e.isUnfolded||(e.isUnfolded={}),void 0!=e.codeFolding&&delete e.codeFolding),e._version=a.version,e.save(!0)},L=function(){try{var n=j.text();""==n||"null"==n?j.text("Empty"):(S=JSON.parse(n),D=JSON.parse(A.text()),j.text(""))}catch(o){j.text("Could not load data")}if(S)if(V(S,""),_.html('<ul class="gina-toolbar-code">'+q(S,D)+"</ul>"),e.currentFile=S.file,e.currentFile){if(S.file==e.currentFile)for(var l in e.isUnfolded)"undefined"!=typeof a.foldingPaths[l]&&W($(".gina-toolbar-folding-state-"+l))}else e.currentFile=S.file},R=function(){_.on("click","a",function(a){a.preventDefault(),W($(this))}),U.on("click",function(a){a.preventDefault(),W("all")}),_.on("click",".gina-toolbar-value",function(a){a.preventDefault();try{E=$(this).text(),N.text(E),N.select(),document.execCommand("copy",!1,null),N.blur()}catch(n){alert("Please press Ctrl/Cmd+C to copy the value")}}),F.on("click",function(a){if(S){var n=window.open("","JSON RAW","width=400,height=100");n.document.write(JSON.stringify(S))}}),s.on("click",function(a){a.preventDefault(),s.removeClass("gina-toolbar-active"),c.removeClass("gina-toolbar-active"),$(this).addClass("gina-toolbar-active"),u=$(this).attr("href"),d=$(u).addClass("gina-toolbar-active"),e.panelId=u,e.save()}),r.on("click",function(a){a.preventDefault(),t.toggleClass("gina-toolbar-collapsed"),i=t.hasClass("gina-toolbar-collapsed"),e.isCollapsed=i,e.save()}),p.on("change",function(a){a.preventDefault();var n=f.val(),o=b.val();v=n+"-"+o,z(v),e.position=v,e.save()}),h.on("change",function(a){a.preventDefault(),y=h.val(),M(y),e.width=y,e.save()}),$(window).on("resize",function(){B()}),$("body").on("keypress",function(a){k=a.keyCode?a.keyCode:a.which?a.which:a.charCode;var n=new Date;if("undefined"!=typeof x.keynum&&x.keynum==k&&"undefined"!=typeof x.pressTime&&n.getTime()-x.pressTime<500)switch(k){case 103:t.toggle()}x.pressTime=n.getTime(),x.keynum=k}),s.filter('[href="'+u+'"]').trigger("click"),i||$("#gina-toolbar-toggle").trigger("click"),z(v);var a=v.split("-");f.val(a[0]),b.val(a[1]),M(y),h.val(y),B();var n=j.text();/^\{\{ (.*) \}\}/.test(n)?Q(n,L):L()},z=function(a){t.removeClass("gina-toolbar-top-left gina-toolbar-top-right gina-toolbar-bottom-left gina-toolbar-bottom-right").addClass("gina-toolbar-"+a)},M=function(a){t.removeClass("gina-toolbar-auto gina-toolbar-100 gina-toolbar-80 gina-toolbar-60 gina-toolbar-50 gina-toolbar-40 gina-toolbar-30").addClass("gina-toolbar-"+a)},B=function(){w=window.innerHeight-32,t.find(".gina-toolbar-main").css("max-height",w+"px"),H()},H=function(){var a=d.find(".gina-toolbar-main"),n=a.find(".gina-toolbar-content");C=a.height(),C==w?n.addClass("gina-toolbar-content-end"):n.removeClass("gina-toolbar-content-end")},W=function(n){void 0!=n&&n.length&&(n.next("ul").slideToggle("fast"),n.toggleClass("gina-toolbar-unfolded"),null!=J&&window.clearTimeout(J),J=window.setTimeout(H,300),a.foldingClass=n.attr("class"),a.foldingClass=a.foldingClass.match(/gina-toolbar-folding-state-([-a-z]+)/)[1],n.hasClass("gina-toolbar-unfolded")?(e.isUnfolded[a.foldingClass]=!0,e.save()):(delete e.isUnfolded[a.foldingClass],e.save(!0)))},q=function(a,n,o){var l="",o=o||"",t="",e="";for(var i in a)"object"!=typeof a[i]||Array.isArray(a[i])?Array.isArray(a[i])?(o+=i+"-",l+='<li class="gina-toolbar-collection">',l+='<a href="#" class="gina-toolbar-key gina-toolbar-folding-state-'+o.substr(0,o.length-1)+'">'+i+" <span>["+a[i].length+"]</span></a>",l+='<ul class="gina-toolbar-collection">'+G(a[i],n[i],o)+"</ul>",l+="</li>",o=o.substr(0,o.length-i.length-1)):(e=typeof n[i],a[i]!==n[i]?(l+='<li class="gina-toolbar-key-value gina-toolbar-is-overriden">',l+='<span class="gina-toolbar-key">'+i+':</span> <span class="gina-toolbar-value gina-toolbar-value-type-is-'+e+'">'+a[i]+"</span>",l+="</li>",l+='<li class="gina-toolbar-key-value">',l+='<span class="gina-toolbar-key">'+i+':</span> <span class="gina-toolbar-value">'+n[i]+"</span>",l+="</li>"):(l+='<li class="gina-toolbar-key-value">',l+='<span class="gina-toolbar-key">'+i+':</span> <span class="gina-toolbar-value">'+a[i]+"</span>",l+="</li>")):(o+=i+"-",l+='<li class="gina-toolbar-object">',l+='<a href="#" class="gina-toolbar-key gina-toolbar-folding-state-'+o.substr(0,o.length-1)+'">'+i+" <span>{ }</span></a>",l+='<ul class="gina-toolbar-object">'+q(a[i],n[i],o)+"</ul>",l+="</li>",o=o.substr(0,o.length-i.length-1));return l},G=function(a,n,o){for(var l="",o=o||"",t=0,e=a.length;e>t;++t)"object"!=typeof a[t]||Array.isArray(a[t])?Array.isArray(a[t])?(o+=t+"-",l+='<li class="gina-toolbar-collection">',l+='<a href="#" class="gina-toolbar-key gina-toolbar-folding-state-'+o.substr(0,o.length-1)+'"">'+t+"<span>[ ]</span></a>",l+='<ul class="gina-toolbar-collection">'+G(a[t],n[t],o)+"</ul>",l+="</li>",o=o.substr(0,o.length-t.toString().length-1)):l+='<li class="gina-toolbar-key-value"><span class="gina-toolbar-key">'+t+':</span> <span class="gina-toolbar-value">'+a[t]+"</span></li>":(o+=t+"-",l+='<li class="gina-toolbar-object">',l+='<a href="#" class="gina-toolbar-key gina-toolbar-folding-state-'+o.substr(0,o.length-1)+'">'+t+" <span>{ }</span></a>",l+='<ul class="gina-toolbar-object">'+q(a[t],n[t],o)+"</ul>",l+="</li>",o=o.substr(0,o.length-t.toString().length-1));return l},K=function(a,n){var o="";return o='<label class="gina-toolbar-input-file">',o+='<input type="file" id="'+a+'">',o+=n,o+="</label>"},Q=function(a,n){var o=K("mock","Select your JSON file");return _.html(o),j.text(""),_.find("input").on("change",function(a){var o=$(this)[0].files[0],l=new FileReader;l.addEventListener("load",function(){j.text(l.result),n()},!1),l.readAsBinaryString(o)}),!1},V=function(n,o){for(var l in n)"object"==typeof n[l]&&(a.foldingPaths[o+l]=o+l,V(n[l],o+l+"-"))};I()};window.onload=function(){if("undefined"==typeof window.gina)throw new Error("`gina` dependency is missing: did you load `gina.min.js` ?");"undefined"==typeof window.gina||window.gina.isFrameworkLoaded||new Toolbar};